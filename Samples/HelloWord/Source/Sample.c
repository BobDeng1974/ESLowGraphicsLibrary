#include "..\..\..\code\Graphics.h"
#include "SysUtils.h"
#include "GlobalInput.h"
#include "Math.h"

const unsigned char Logo_data[] =
{
  0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0x7F,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFF,0xFF,0xFF,0xFC,
  0x1F,0xFF,0xFF,0x87,0xFF,0x37,0xFF,0xFF,0xFF,0xFE,0x7F,0xFF,0xFF,0xFD,0xFF,0xFF,
  0xFF,0x7B,0xFF,0x77,0xFF,0xFF,0xFF,0xFC,0xFF,0xFF,0xFF,0xFD,0xF8,0x8C,0x71,0x7F,
  0x8E,0x23,0xFF,0xFF,0xFF,0xFE,0x7F,0xFF,0xFF,0xFC,0x1B,0xBB,0xB7,0x9F,0x77,0x77,
  0xFF,0xFF,0xFF,0xFC,0xFF,0xFF,0xFF,0xFD,0xFB,0xBB,0xB7,0xE7,0x77,0x77,0xFF,0xFF,
  0xFF,0xFE,0x7F,0xFF,0xFF,0xFD,0xFB,0xBB,0xB7,0xFB,0x77,0x77,0xFF,0xFF,0xFF,0xFC,
  0xFF,0xFF,0xFF,0xFD,0xFB,0xBB,0xB7,0x7B,0x77,0x77,0xFF,0xFF,0xFF,0xFE,0x7F,0xFF,
  0xFF,0xFC,0x1B,0xBC,0x77,0x87,0x8F,0x73,0xFF,0xFF,0xFF,0xFC,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFE,0x5F,0xFF,0xFF,0xC3,0xFF,0xFF,0xEF,0xBF,0xFF,0xDF,
  0x6F,0xDF,0xFF,0xFC,0xDF,0xFF,0xFF,0xBD,0xFF,0xFF,0xEF,0xFF,0xFF,0xDF,0xEF,0xDF,
  0xFF,0xFE,0x5F,0x8E,0xDB,0x7F,0x8C,0x70,0xE1,0xB8,0xF1,0xDF,0x61,0xDC,0x71,0x74,
  0xDF,0x76,0xDB,0x7F,0xBB,0xB7,0x6E,0xB7,0x6E,0xDF,0x6E,0xDB,0xB7,0x76,0x5F,0x76,
  0xAB,0x71,0xBC,0x37,0x6E,0xB7,0xF3,0xDF,0x6E,0xDC,0x37,0x74,0xDF,0x76,0xAB,0x7D,
  0xBB,0xB7,0x6E,0xB7,0xFD,0xDF,0x6E,0xDB,0xB7,0xAE,0x5F,0x77,0x77,0xBD,0xBB,0xB7,
  0x6E,0xB7,0x6E,0xDF,0x6E,0xDB,0xB7,0xAC,0xC1,0x8F,0x77,0xC3,0xBC,0x50,0xEE,0xB8,
  0xF1,0xC1,0x61,0xDC,0x57,0xDE,0x7F,0xFF,0xFF,0xFF,0xFF,0xF7,0xFF,0xFF,0xFF,0xFF,
  0xFF,0xFF,0xFF,0xDC,0xFF,0xFF,0xFF,0xFF,0xFF,0xF7,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  0xFF,0x3E,0x7F,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFC,
  0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,0xAA,
};

#define clBlack 0 
#define clWhite 1 
#define clInvert 2 
 
void SampleMain(void);

int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow)
{
  SysCreateScreen(256, 128, pf1bit, CS_ZOOM4);

  SampleMain();
}

void SampleMain(void) 
{ 
  PBitMap BitMap, Logo;
  TRect LogoRect, Rect;
  float t;
  int x, y, s;

  esSetSkipLastPixel(0);
 
  BitMap = esCreateBitMap(SysGetScreenWidth(), SysGetScreenHeight(), SysGetPixelFormat()); 
  Logo = esCreateStaticBitMap(111, 25, pf1bit, Logo_data);

  LogoRect.x1 = 0;
  LogoRect.y1 = 0;
  LogoRect.x2 = 111;
  LogoRect.y2 = 25;

  while(1)
  {
    // background
    esClear(BitMap, clWhite);
    esDrawRect(BitMap, 0, 0, 255, 127, clBlack); 
    esFillEllipse(BitMap, 0, 0, 255, 127, clBlack); 
    esFillRect(BitMap, 0, 0, 255, 63, clInvert); 
    // sinus
    t = SysGetTime() * 0.002;
    for(x = 0; x < 256; x++, t += 0.1)
    {
      y = 63 + sin(t + cos(t* 0.3))*30;
      esSetPixel(BitMap, x, y, clInvert);
      s = 5 + sin(t*0.3)*5;
      if(x % 10 == 0)
      { 
        esFillEllipse(BitMap, x - s, y - s, x + s, y + s, clBlack); 
        esDrawEllipse(BitMap, x - s, y - s, x + s, y + s, clWhite);
      }
    }
    // logo
    Rect.x1 = 50 + sin(t) * 30;
    Rect.x2 = 205 + sin(t * 0.8) * 30;
    Rect.y1 = 45 + sin(t * 1.7) * 20;
    Rect.y2 = 85 + sin(t * 1.3) * 20;
    esStrechDraw(BitMap, Rect, Logo, LogoRect);

    SysDrawBuffer(BitMap->Pixels);
  }

  esFreeBitMap(BitMap); 
  esFreeStaticBitMap(Logo);
} 
